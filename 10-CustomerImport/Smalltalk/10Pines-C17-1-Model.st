Object subclass: #Address	instanceVariableNames: 'id streetName streetNumber town zipCode province'	classVariableNames: ''	poolDictionaries: ''	category: '10Pines-C17-1-Model'!!Address methodsFor: 'zip code' stamp: 'HernanWilkinson 10/28/2016 16:13'!zipCode	^zipCode! !!Address methodsFor: 'zip code' stamp: 'HernanWilkinson 10/28/2016 16:08'!zipCode: aZipCode 	zipCode := aZipCode! !!Address methodsFor: 'province' stamp: 'HernanWilkinson 10/28/2016 16:11'!province	^province! !!Address methodsFor: 'province' stamp: 'HernanWilkinson 10/28/2016 16:08'!province: aProvince 	province := aProvince	! !!Address methodsFor: 'twon' stamp: 'HernanWilkinson 10/28/2016 16:07'!town: aTown 	town := aTown! !!Address methodsFor: 'twon' stamp: 'HernanWilkinson 10/28/2016 16:12'!town	^town! !!Address methodsFor: 'street' stamp: 'HernanWilkinson 10/28/2016 13:27'!streetName: aStreetName 	streetName := aStreetName ! !!Address methodsFor: 'street' stamp: 'HernanWilkinson 10/28/2016 16:12'!streetNumber	^streetNumber ! !!Address methodsFor: 'street' stamp: 'HernanWilkinson 10/28/2016 16:12'!streetName	^streetName ! !!Address methodsFor: 'street' stamp: 'HernanWilkinson 10/28/2016 13:27'!streetNumber: aStreetNumber 	streetNumber := aStreetNumber ! !Object subclass: #Customer	instanceVariableNames: 'id firstName lastName identificationType identificationNumber addresses'	classVariableNames: ''	poolDictionaries: ''	category: '10Pines-C17-1-Model'!!Customer methodsFor: 'identification' stamp: 'HernanWilkinson 10/28/2016 16:13'!identificationType		^identificationType ! !!Customer methodsFor: 'identification' stamp: 'HernanWilkinson 10/28/2016 13:10'!identificationNumber: anIdentificationNumber 	identificationNumber := anIdentificationNumber! !!Customer methodsFor: 'identification' stamp: 'HernanWilkinson 10/28/2016 13:10'!identificationType: anIdentificationType 	identificationType := anIdentificationType! !!Customer methodsFor: 'identification' stamp: 'HernanWilkinson 10/28/2016 16:13'!identificationNumber		^identificationNumber ! !!Customer methodsFor: 'addresses' stamp: 'HernanWilkinson 10/28/2016 13:25'!addresses	^ addresses! !!Customer methodsFor: 'addresses' stamp: 'HernanWilkinson 10/28/2016 13:27'!addAddress: anAddress 	addresses add: anAddress ! !!Customer methodsFor: 'name' stamp: 'HernanWilkinson 10/28/2016 16:15'!lastName	^lastName ! !!Customer methodsFor: 'name' stamp: 'HernanWilkinson 10/28/2016 13:09'!firstName: aName 	firstName := aName! !!Customer methodsFor: 'name' stamp: 'HernanWilkinson 10/28/2016 13:09'!lastName: aLastName 	lastName := aLastName! !!Customer methodsFor: 'name' stamp: 'HernanWilkinson 10/28/2016 16:15'!firstName		^firstName ! !!Customer methodsFor: 'importing' stamp: 'ip 11/6/2017 21:53'!addressAt: aStreetName	^ self addresses		detect: [ :anAddress | anAddress streetName = aStreetName ]! !!Customer methodsFor: 'importing' stamp: 'ip 11/6/2017 21:19'!importCustomers: anObject	"	self importCustomers	"	test importCustomers: nil! !!Customer methodsFor: 'initialization' stamp: 'HernanWilkinson 10/28/2016 13:26'!initialize	super initialize.	addresses := OrderedCollection new.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!Customer class	instanceVariableNames: ''!!Customer class methodsFor: 'importing' stamp: 'HernanWilkinson 11/1/2016 08:39'!importCustomers	"	self importCustomers	"	| inputStream session newCustomer line |		inputStream := FileStream fileNamed: 'input.txt'.	session := DataBaseSession for: (Array 		with: (ClassMapping 			withDefaultTableNameFor: Address 			mappingAll: (Array 				with: (EmbededMapping withDefaultFieldNameFor: #streetName)				with: (EmbededMapping withDefaultFieldNameFor: #streetNumber)				with: (EmbededMapping withDefaultFieldNameFor: #town)				with: (EmbededMapping withDefaultFieldNameFor: #zipCode)				with: (EmbededMapping withDefaultFieldNameFor: #province))) 		with: (ClassMapping 			withDefaultTableNameFor: Customer 			mappingAll: (Array 				with: (EmbededMapping withDefaultFieldNameFor: #firstName)				with: (EmbededMapping withDefaultFieldNameFor: #lastName)				with: (EmbededMapping withDefaultFieldNameFor: #identificationType)				with: (EmbededMapping withDefaultFieldNameFor: #identificationNumber)				with: (OneToManyMapping withDefaultFieldNameFor: #addresses ofType: Address)))).	session open.	session beginTransaction.	line := inputStream nextLine.	[ line notNil ] whileTrue: [ 		(line beginsWith: 'C') ifTrue: [ | customerData |			customerData := line substrings: {$,}.			newCustomer := Customer new.			newCustomer firstName: customerData second.			newCustomer lastName: customerData third.			newCustomer identificationType: customerData fourth.			newCustomer identificationNumber: customerData fourth.			session persist: newCustomer ].				(line beginsWith: 'A') ifTrue: [ | addressData newAddress |			addressData := line substrings: { $, }.			newAddress := Address new.			newAddress streetName: addressData second.			newAddress streetNumber: addressData third asInteger. 			newAddress town: addressData fourth.			newAddress zipCode: addressData fifth asInteger.			newAddress province: addressData fourth.			newCustomer addAddress: newAddress. ].						line := inputStream nextLine. ].					session commit.		session close.				inputStream close.		! !Object subclass: #CustomerImporter	instanceVariableNames: 'line inputStream customerData addressData session currentCustomer record'	classVariableNames: ''	poolDictionaries: ''	category: '10Pines-C17-1-Model'!!CustomerImporter methodsFor: 'importing' stamp: 'BrianBokser 11/9/2017 19:27'!hasLineToProcess	line := inputStream nextLine.	^ line notNil! !!CustomerImporter methodsFor: 'importing' stamp: 'BrianBokser 11/9/2017 20:01'!isCustomerRecord	^ line beginsWith: 'C'! !!CustomerImporter methodsFor: 'importing' stamp: 'BrianBokser 11/9/2017 21:39'!ifIsCustomerRecord: aCustomerBlock ifIsAddressRecord: anAddressBlock else: anElseBlock	self ifIsCustomerLine: [ 				^ aCustomerBlock value].	self ifIsAddressLine: [ 		^ anAddressBlock value].	anElseBlock value. ! !!CustomerImporter methodsFor: 'importing' stamp: 'BrianBokser 11/9/2017 20:01'!isAddressRecord	^ line beginsWith: 'A'! !!CustomerImporter methodsFor: 'importing' stamp: 'BrianBokser 11/9/2017 20:19'!import	[ self hasLineToProcess ] whileTrue:		[ self importNextRecord ]! !!CustomerImporter methodsFor: 'importing' stamp: 'BrianBokser 11/9/2017 20:01'!ifIsCustomerLine: aBlock	self isCustomerRecord		ifTrue: aBlock! !!CustomerImporter methodsFor: 'importing' stamp: 'BrianBokser 11/9/2017 20:10'!parseRecord	record := line substrings: {$,}! !!CustomerImporter methodsFor: 'importing' stamp: 'BrianBokser 11/9/2017 21:29'!importNextRecord	self parseRecord .	self		ifIsCustomerRecord: [			currentCustomer := self importNewCustomer.			session persist: currentCustomer ]		ifIsAddressRecord: [ | newAddress |			newAddress := self importNewAddress.			currentCustomer addAddress: newAddress ]		else: [Error signal: CustomerImporter recordStartsWithInvalidCharacterErrorMessage ].! !!CustomerImporter methodsFor: 'importing' stamp: 'BrianBokser 11/9/2017 20:11'!importNewAddress	| newAddress |	newAddress := Address new.	newAddress streetName: record second.	newAddress streetNumber: record third asInteger.	newAddress town: record fourth.	newAddress zipCode: record fifth asInteger.	newAddress province: record sixth.	^ newAddress! !!CustomerImporter methodsFor: 'importing' stamp: 'BrianBokser 11/9/2017 20:11'!importNewCustomer	| newCustomer |	newCustomer := Customer new.	newCustomer firstName: record second.	newCustomer lastName: record third.	newCustomer identificationType: record fourth.	newCustomer identificationNumber: record fifth.	^ newCustomer! !!CustomerImporter methodsFor: 'importing' stamp: 'BrianBokser 11/9/2017 20:19'!initializeWithInputStream: anInputStream withSession: aSession	inputStream := anInputStream.	session := aSession.! !!CustomerImporter methodsFor: 'importing' stamp: 'BrianBokser 11/9/2017 20:32'!ifIsAddressLine: aBlock	self isAddressRecord		ifTrue: aBlock! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!CustomerImporter class	instanceVariableNames: ''!!CustomerImporter class methodsFor: 'as yet unclassified' stamp: 'BrianBokser 11/9/2017 20:17'!withInputStream: anInputStream withSession: aSession	^ self new initializeWithInputStream: anInputStream withSession: aSession.! !!CustomerImporter class methodsFor: 'as yet unclassified' stamp: 'BrianBokser 11/9/2017 20:41'!recordStartsWithInvalidCharacterErrorMessage	^ 'Record starts with invalid character'! !TestCase subclass: #CustomerImporterTest	instanceVariableNames: 'session'	classVariableNames: ''	poolDictionaries: ''	category: '10Pines-C17-1-Model'!!CustomerImporterTest methodsFor: 'importing' stamp: 'ip 11/6/2017 22:09'!assertCustomerPepeSanchezWasImportedCorrectly	| aCustomer aCustomerAddress |	aCustomer := self		customerAt: session		withIdentificationNumber: '22333444'		withIdentificationType: 'D'.	self		assertCustomer: aCustomer		hasFirstName: 'Pepe'		hasLastName: 'Sanchez'		hasIdentificationType: 'D'		hasIdentificationNumber: '22333444'.	self assert: aCustomer addresses size equals: 2.	aCustomerAddress := aCustomer addressAt: 'San Martin'.	self		assertCustomerAddress: aCustomerAddress		hasStreetName: 'San Martin'		hasStreetNumber: 3322		hasTown: 'Olivos'		hasZipCode: 1636.	aCustomerAddress := aCustomer addressAt: 'Maipu'.	self assert: aCustomerAddress town equals: 'Florida'.	self assert: aCustomerAddress zipCode equals: 1122.	self assert: aCustomerAddress province equals: 'Buenos Aires'! !!CustomerImporterTest methodsFor: 'importing' stamp: 'BrianBokser 11/9/2017 20:20'!test01	| aCustomerImporter |	aCustomerImporter := CustomerImporter withInputStream: self validTestData withSession: session.	aCustomerImporter import.	self assertCorrectNumberOfCustomersWereImported.	self assertCustomerPepeSanchezWasImportedCorrectly.	self assertCustomerJuanPerezWasImportedCorrectly! !!CustomerImporterTest methodsFor: 'importing' stamp: 'ip 11/6/2017 21:56'!assertCorrectNumberOfCustomersWereImported	self assert: (session selectAllOfType: Customer) size equals: 2! !!CustomerImporterTest methodsFor: 'importing' stamp: 'ip 11/6/2017 22:05'!assertCustomer: aCustomer hasFirstName: firstName hasLastName: lastName hasIdentificationType: identificationType hasIdentificationNumber: identificationNumber	self assert: aCustomer firstName equals: firstName.	self assert: aCustomer lastName equals: lastName.	self assert: aCustomer identificationType equals: identificationType.	self assert: aCustomer identificationNumber equals: identificationNumber.! !!CustomerImporterTest methodsFor: 'importing' stamp: 'ip 11/6/2017 22:00'!customerAt: aSession withIdentificationNumber: anIdentificationNumber withIdentificationType: anIdentificationType	^ (aSession		select:			[ :aCustomer | aCustomer identificationNumber = anIdentificationNumber and: aCustomer identificationType = anIdentificationType ]		ofType: Customer) anyOne! !!CustomerImporterTest methodsFor: 'importing' stamp: 'ip 11/6/2017 21:19'!setUp	session := DataBaseSession		for:			(Array				with:					(ClassMapping						withDefaultTableNameFor: Address						mappingAll:							(Array								with: (EmbededMapping withDefaultFieldNameFor: #streetName)								with: (EmbededMapping withDefaultFieldNameFor: #streetNumber)								with: (EmbededMapping withDefaultFieldNameFor: #town)								with: (EmbededMapping withDefaultFieldNameFor: #zipCode)								with: (EmbededMapping withDefaultFieldNameFor: #province)))				with:					(ClassMapping						withDefaultTableNameFor: Customer						mappingAll:							(Array								with: (EmbededMapping withDefaultFieldNameFor: #firstName)								with: (EmbededMapping withDefaultFieldNameFor: #lastName)								with: (EmbededMapping withDefaultFieldNameFor: #identificationType)								with: (EmbededMapping withDefaultFieldNameFor: #identificationNumber)								with: (OneToManyMapping withDefaultFieldNameFor: #addresses ofType: Address)))).	session open.	session beginTransaction.	inputStream := FileStream fileNamed: 'input.txt'.! !!CustomerImporterTest methodsFor: 'importing' stamp: 'ip 11/6/2017 21:19'!tearDown	inputStream close.	session commit.	session close.! !!CustomerImporterTest methodsFor: 'importing' stamp: 'ip 11/6/2017 22:09'!assertCustomerAddress: aCustomerAddress hasStreetName: streetName hasStreetNumber: streetNumber hasTown: town hasZipCode: zipCode	self assert: aCustomerAddress streetName equals: streetName.	self assert: aCustomerAddress streetNumber equals: streetNumber.	self assert: aCustomerAddress town equals: town.	self assert: aCustomerAddress zipCode equals: zipCode.	self assert: aCustomerAddress province equals: 'BsAs'! !!CustomerImporterTest methodsFor: 'importing' stamp: 'BrianBokser 11/9/2017 20:41'!assertDidNotImportAnyCustomer! !!CustomerImporterTest methodsFor: 'importing' stamp: 'ip 11/6/2017 22:05'!assertCustomerJuanPerezWasImportedCorrectly	| aCustomer aCustomerAddress |	aCustomer := self		customerAt: session		withIdentificationNumber: '23-25666777-9'		withIdentificationType: 'C'.	self		assertCustomer: aCustomer		hasFirstName: 'Juan'		hasLastName: 'Perez'		hasIdentificationType: 'C'		hasIdentificationNumber: '23-25666777-9'.	self assert: aCustomer addresses size equals: 1.	aCustomerAddress := aCustomer addressAt: 'Alem'.	self assert: aCustomerAddress town equals: 'CABA'.	self assert: aCustomerAddress zipCode equals: 1001.	self assert: aCustomerAddress province equals: 'CABA'! !!CustomerImporterTest methodsFor: 'importing' stamp: 'BrianBokser 11/9/2017 20:42'!test02	| aCustomerImporter anInvalidInputStream |	anInvalidInputStream := ReadStream on: 'X, '.	aCustomerImporter := CustomerImporter withInputStream: anInvalidInputStream withSession: session.		self should: [aCustomerImporter import.						self fail.]	raise: Exception 	withExceptionDo: [:anError | 		self assert: (CustomerImporter recordStartsWithInvalidCharacterErrorMessage = anError messageText).		self assertDidNotImportAnyCustomer. 		].! !!CustomerImporterTest methodsFor: 'as yet unclassified' stamp: 'BrianBokser 11/9/2017 18:36'!validTestData	^ ReadStream on: 'C,Pepe,Sanchez,D,22333444A,San Martin,3322,Olivos,1636,BsAsA,Maipu,888,Florida,1122,Buenos AiresC,Juan,Perez,C,23-25666777-9A,Alem,1122,CABA,1001,CABA'.! !